<%#
 Copyright (C) 2017 Xingwang Liao <kuoruan@gmail.com>
 Licensed to the public under the GNU General Public License v3.
-%>

<script type="text/javascript">//<![CDATA[
	XHR.poll(5, '<%=url("admin/services/shadowsocks/status")%>', null,
		function(x, info) {
			var redir_tb = document.getElementById('_redir_status');
			var local_tb = document.getElementById('_local_status');
			var tunnel_tb = document.getElementById('_tunnel_status');

			if (redir_tb) {
				var redir_text;
				switch (info.redir_status) {
					case 0:
						redir_text = '<%:NOT RUNNING%>';
						break;
					case 1:
						redir_text = '<%:RUNNING%> (SS)';
						break;
					case 2:
						redir_text = '<%:RUNNING%> (SSR)';
						break;
					default:
						redir_text = '<%:UNKNOWN%>';
				}

				redir_tb.innerHTML = redir_text;
			}

			if (local_tb) {
				var local_text;
				switch (info.local_status) {
					case 0:
						local_text = '<%:NOT RUNNING%>';
						break;
					case 1:
						local_text = '<%:RUNNING%> (SS)';
						break;
					case 2:
						local_text = '<%:RUNNING%> (SSR)';
						break;
					default:
						local_text = '<%:UNKNOWN%>';
				}

				local_tb.innerHTML = local_text;
			}

			if (tunnel_tb) {
				var tunnel_text;
				switch (info.tunnel_status) {
					case 0:
						tunnel_text = '<%:NOT RUNNING%>';
						break;
					case 1:
						tunnel_text = '<%:RUNNING%> (SS)';
						break;
					case 2:
						tunnel_text = '<%:RUNNING%> (SSR)';
						break;
					default:
						tunnel_text = '<%:UNKNOWN%>';
				}

				tunnel_tb.innerHTML = tunnel_text;
			}
		}
	);
//]]></script>

<fieldset class="cbi-section" id="_status_table">
	<legend><%:Running Status%></legend>

	<fieldset class="cbi-section-node">
		<table width="100%" cellspacing="10">
			<tr><td width="33%"><%:Transparent Proxy%></td><td id="_redir_status"><em><%:Collecting data...%></em></td></tr>
			<tr><td width="33%"><%:SOCKS5 Proxy%></td><td id="_local_status"><em><%:Collecting data...%></em></td></tr>
			<tr><td width="33%"><%:Port Forward%></td><td id="_tunnel_status"><em><%:Collecting data...%></em></td></tr>
		</table>
	</fieldset>
</fieldset>
